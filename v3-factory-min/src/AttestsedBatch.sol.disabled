// SPDX-License-Identifier: MIT
pragma solidity ^0.8.20;

/// @title AttestedBatch
/// @notice Runs multiple calls atomically, requiring a credential attestation.
contract AttestedBatch {
    address public credentialIssuer;

    constructor(address _issuer) {
        credentialIssuer = _issuer;
    }

    modifier onlyWithCredential(bytes calldata proof) {
        // ğŸ‘‰ ì—¬ê¸°ì„œ XRPL Credential ê²€ì¦ ë¡œì§(ë˜ëŠ” ìŠ¤í…) ë„£ê¸°
        // ì§€ê¸ˆì€ ë‹¨ìˆœíˆ issuer ì„œëª… ì£¼ì†Œ ì²´í¬ ì˜ˆì‹œë§Œ
        require(keccak256(proof) != 0, "Invalid credential");
        _;
    }

    /// @notice Execute multiple calls atomically (all-or-nothing)
    function executeBatch(address[] calldata targets, bytes[] calldata data, bytes calldata proof)
        external
        onlyWithCredential(proof)
    {
        require(targets.length == data.length, "Length mismatch");

        for (uint i = 0; i < targets.length; i++) {
            (bool ok, bytes memory res) = targets[i].call(data[i]);
            require(ok, string(res)); // atomic: í•˜ë‚˜ë¼ë„ ì‹¤íŒ¨í•˜ë©´ revert
        }
    }
}
